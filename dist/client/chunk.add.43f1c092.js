webpackJsonp([2,3],{170:171,332:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=a(49),l=n(i),s=a(50),u=n(s),d=a(51),o=n(d),c=a(53),r=n(c),m=a(52),p=n(m),h=a(6),f=n(h);a(38);a(170);var g=function(e){function t(e){(0,u.default)(this,t);var a=(0,r.default)(this,(t.__proto__||(0,l.default)(t)).call(this,e));return a.state={tagvalue:"",title:"",desc:"",process:0,imgpath:"",isimgpath:-1},a}return(0,p.default)(t,e),(0,o.default)(t,[{key:"componentWillMount",value:function(){}},{key:"componentDidMount",value:function(){huch.loadScript("/common/editor/wangEditor.js",function(){var e=new wangEditor("editor");e.config.uploadImgUrl="/upimage",e.create()})}},{key:"updata",value:function(e){var t=$("#editor").html(),a=this.state;return""==a.imgpath?void alert("请上传封面图片"):void huch.post("/api/add",{title:a.title,tag:a.tagvalue,desc:a.desc,text:t,imgpath:a.imgpath,time:(new Date).getTime()},function(e){0==e.code?window.location.href="/":alert("数据库保存失败")})}},{key:"inputChange",value:function(e,t){var a=t.target.value,n=this.state;n[e]=a,this.setState({})}},{key:"upimg",value:function(e){var t=this,a=e.target.files;if(a.length){var n=new FormData;n.append("upload",a[0]);var i=new XMLHttpRequest;i.open("POST","/upimage"),i.upload.onprogress=function(e){if(e.lengthComputable){var a=e.loaded/e.total*100|0;t.setState({isimgpath:0,process:a})}},i.onload=function(){200===i.status?(console.log("上传成功"),t.setState({imgpath:i.response,isimgpath:1})):console.log("出错了")},i.send(n)}}},{key:"render",value:function(){var e=this.state.isimgpath;return f.default.createElement("div",{className:"add_detail"},f.default.createElement("div",{className:"add_con clearfix"},f.default.createElement("div",{className:"add_input fl"},f.default.createElement("div",{className:"add_title"},f.default.createElement("span",{className:"tit_name"},"标题:"),f.default.createElement("input",{defaultValue:this.state.tagvalue,onChange:this.inputChange.bind(this,"title")})),f.default.createElement("div",{className:"add_tag"},f.default.createElement("span",{className:"tag_name"},"标签:"),f.default.createElement("input",{defaultValue:this.state.tagvalue,onChange:this.inputChange.bind(this,"tagvalue")})),f.default.createElement("div",{className:"add_desc"},f.default.createElement("span",{className:"desc_name"},"简介:"),f.default.createElement("textarea",{defaultValue:this.state.tagvalue,onChange:this.inputChange.bind(this,"desc")}))),f.default.createElement("div",{className:"add_img fl"},e==-1?"封面图片上传":0==e?this.state.process+"%":f.default.createElement("span",null,f.default.createElement("img",{src:this.state.imgpath})),f.default.createElement("input",{type:"file",onChange:this.upimg.bind(this)}))),f.default.createElement("div",{id:"editor",style:{"min-height":"500px"}}),f.default.createElement("div",{className:"upHtml",onClick:this.updata.bind(this)},"提交"))}}]),t}(h.Component);e.exports=g}});